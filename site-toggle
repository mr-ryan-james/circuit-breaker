#!/usr/bin/env bash
set -Eeuo pipefail

# Thin wrapper that preserves the passwordless sudo entrypoint at:
#   /Users/ryanpfister/Dev/circuit-breaker/site-toggle
#
# It executes the compiled TypeScript CLI. Root/sudo is only needed for commands
# that edit /etc/hosts (on/off/choose feed/daemon tick).

NODE_BIN="${NODE_BIN:-/opt/homebrew/bin/node}"
CLI_JS="/Users/ryanpfister/Dev/circuit-breaker/packages/cli/dist/index.js"

if [[ ! -x "$NODE_BIN" ]]; then
  # Fall back to common Homebrew locations and PATH.
  if [[ -x "/opt/homebrew/opt/node@24/bin/node" ]]; then
    NODE_BIN="/opt/homebrew/opt/node@24/bin/node"
  elif command -v node >/dev/null 2>&1; then
    NODE_BIN="$(command -v node)"
  else
    echo "Missing Node binary at ${NODE_BIN}"
    echo "Install Node via Homebrew (or ensure `node` is on PATH), or export NODE_BIN=/path/to/node"
    exit 1
  fi
fi

if [[ ! -f "$CLI_JS" ]]; then
  echo "Missing compiled CLI at $CLI_JS"
  echo "Run: pnpm install && pnpm build"
  exit 1
fi

exec "$NODE_BIN" --no-warnings "$CLI_JS" "$@"
